var Ze=Object.defineProperty,Je=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ue=(e,t,a)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,H=(e,t)=>{for(var a in t||(t={}))Se.call(t,a)&&ue(e,a,t[a]);if(oe)for(var a of oe(t))De.call(t,a)&&ue(e,a,t[a]);return e},Pe=(e,t)=>Je(e,Ke(t));var Ie=(e,t)=>{var a={};for(var o in e)Se.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(e!=null&&oe)for(var o of oe(e))t.indexOf(o)<0&&De.call(e,o)&&(a[o]=e[o]);return a};var q=(e,t,a)=>(ue(e,typeof t!="symbol"?t+"":t,a),a);import{g as Te,_ as V,d as N,r as L,o as P,h as B,a as f,i as C,j as ie,v as re,p as Q,e as ee,F as xe,k as Me,t as Fe,n as X,l as Qe,m as et,q as tt,u as Ue,s as at,x as fe,y as Be,z as ge,c as ot,w as M,A as it,b as rt,B as nt,C as st,f as Re}from"./plugin-vue_export-helper.c3c1043c.js";import{c as lt,F as dt,S as ct,R as ut,L as Ge,D as ft,I as gt,T as pt,a as pe,G as vt,b as ht}from"./Line.02cf2b9e.js";var mt={exports:{}};(function(e){var t=function(a){var o=Object.prototype,d=o.hasOwnProperty,n,l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function m(r,i,s){return Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}),r[i]}try{m({},"")}catch{m=function(i,s,p){return i[s]=p}}function $(r,i,s,p){var g=i&&i.prototype instanceof x?i:x,k=Object.create(g.prototype),O=new le(p||[]);return k._invoke=ae(r,s,O),k}a.wrap=$;function w(r,i,s){try{return{type:"normal",arg:r.call(i,s)}}catch(p){return{type:"throw",arg:p}}}var S="suspendedStart",U="suspendedYield",T="executing",b="completed",_={};function x(){}function y(){}function v(){}var D={};m(D,u,function(){return this});var F=Object.getPrototypeOf,I=F&&F(F(de([])));I&&I!==o&&d.call(I,u)&&(D=I);var E=v.prototype=x.prototype=Object.create(D);y.prototype=v,m(E,"constructor",v),m(v,"constructor",y),y.displayName=m(v,h,"GeneratorFunction");function R(r){["next","throw","return"].forEach(function(i){m(r,i,function(s){return this._invoke(i,s)})})}a.isGeneratorFunction=function(r){var i=typeof r=="function"&&r.constructor;return i?i===y||(i.displayName||i.name)==="GeneratorFunction":!1},a.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,v):(r.__proto__=v,m(r,h,"GeneratorFunction")),r.prototype=Object.create(E),r},a.awrap=function(r){return{__await:r}};function G(r,i){function s(k,O,A,z){var j=w(r[k],r,O);if(j.type==="throw")z(j.arg);else{var ce=j.arg,Z=ce.value;return Z&&typeof Z=="object"&&d.call(Z,"__await")?i.resolve(Z.__await).then(function(Y){s("next",Y,A,z)},function(Y){s("throw",Y,A,z)}):i.resolve(Z).then(function(Y){ce.value=Y,A(ce)},function(Y){return s("throw",Y,A,z)})}}var p;function g(k,O){function A(){return new i(function(z,j){s(k,O,z,j)})}return p=p?p.then(A,A):A()}this._invoke=g}R(G.prototype),m(G.prototype,c,function(){return this}),a.AsyncIterator=G,a.async=function(r,i,s,p,g){g===void 0&&(g=Promise);var k=new G($(r,i,s,p),g);return a.isGeneratorFunction(i)?k:k.next().then(function(O){return O.done?O.value:k.next()})};function ae(r,i,s){var p=S;return function(k,O){if(p===T)throw new Error("Generator is already running");if(p===b){if(k==="throw")throw O;return Le()}for(s.method=k,s.arg=O;;){var A=s.delegate;if(A){var z=ne(A,s);if(z){if(z===_)continue;return z}}if(s.method==="next")s.sent=s._sent=s.arg;else if(s.method==="throw"){if(p===S)throw p=b,s.arg;s.dispatchException(s.arg)}else s.method==="return"&&s.abrupt("return",s.arg);p=T;var j=w(r,i,s);if(j.type==="normal"){if(p=s.done?b:U,j.arg===_)continue;return{value:j.arg,done:s.done}}else j.type==="throw"&&(p=b,s.method="throw",s.arg=j.arg)}}}function ne(r,i){var s=r.iterator[i.method];if(s===n){if(i.delegate=null,i.method==="throw"){if(r.iterator.return&&(i.method="return",i.arg=n,ne(r,i),i.method==="throw"))return _;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var p=w(s,r.iterator,i.arg);if(p.type==="throw")return i.method="throw",i.arg=p.arg,i.delegate=null,_;var g=p.arg;if(!g)return i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,_;if(g.done)i[r.resultName]=g.value,i.next=r.nextLoc,i.method!=="return"&&(i.method="next",i.arg=n);else return g;return i.delegate=null,_}R(E),m(E,h,"Generator"),m(E,u,function(){return this}),m(E,"toString",function(){return"[object Generator]"});function Ce(r){var i={tryLoc:r[0]};1 in r&&(i.catchLoc=r[1]),2 in r&&(i.finallyLoc=r[2],i.afterLoc=r[3]),this.tryEntries.push(i)}function se(r){var i=r.completion||{};i.type="normal",delete i.arg,r.completion=i}function le(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Ce,this),this.reset(!0)}a.keys=function(r){var i=[];for(var s in r)i.push(s);return i.reverse(),function p(){for(;i.length;){var g=i.pop();if(g in r)return p.value=g,p.done=!1,p}return p.done=!0,p}};function de(r){if(r){var i=r[u];if(i)return i.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var s=-1,p=function g(){for(;++s<r.length;)if(d.call(r,s))return g.value=r[s],g.done=!1,g;return g.value=n,g.done=!0,g};return p.next=p}}return{next:Le}}a.values=de;function Le(){return{value:n,done:!0}}return le.prototype={constructor:le,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(se),!r)for(var i in this)i.charAt(0)==="t"&&d.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=n)},stop:function(){this.done=!0;var r=this.tryEntries[0],i=r.completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function s(z,j){return k.type="throw",k.arg=r,i.next=z,j&&(i.method="next",i.arg=n),!!j}for(var p=this.tryEntries.length-1;p>=0;--p){var g=this.tryEntries[p],k=g.completion;if(g.tryLoc==="root")return s("end");if(g.tryLoc<=this.prev){var O=d.call(g,"catchLoc"),A=d.call(g,"finallyLoc");if(O&&A){if(this.prev<g.catchLoc)return s(g.catchLoc,!0);if(this.prev<g.finallyLoc)return s(g.finallyLoc)}else if(O){if(this.prev<g.catchLoc)return s(g.catchLoc,!0)}else if(A){if(this.prev<g.finallyLoc)return s(g.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,i){for(var s=this.tryEntries.length-1;s>=0;--s){var p=this.tryEntries[s];if(p.tryLoc<=this.prev&&d.call(p,"finallyLoc")&&this.prev<p.finallyLoc){var g=p;break}}g&&(r==="break"||r==="continue")&&g.tryLoc<=i&&i<=g.finallyLoc&&(g=null);var k=g?g.completion:{};return k.type=r,k.arg=i,g?(this.method="next",this.next=g.finallyLoc,_):this.complete(k)},complete:function(r,i){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&i&&(this.next=i),_},finish:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.finallyLoc===r)return this.complete(s.completion,s.afterLoc),se(s),_}},catch:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc===r){var p=s.completion;if(p.type==="throw"){var g=p.arg;se(s)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(r,i,s){return this.delegate={iterator:de(r),resultName:i,nextLoc:s},this.method==="next"&&(this.arg=n),_}},a}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(mt);var bt={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let ke=!1,Ve=()=>{};const yt=e=>{ke=e},wt=e=>{Ve=e},_t=(e,t)=>{Ve({type:e,message:t}),ke&&console.log(`[${e}] ${t}`)};var qe={logging:ke,setLogging:yt,setCustomLogger:wt,log:_t};let J=0,ve=0;const Oe=e=>{const[t,a,o]=e.split(":");return parseFloat(t)*60*60+parseFloat(a)*60+parseFloat(o)};var xt=(e,t)=>{if(typeof e=="string")if(e.startsWith("  Duration")){const a=e.split(", ")[0].split(": ")[1],o=Oe(a);t({duration:o,ratio:ve}),(J===0||J>o)&&(J=o)}else if(e.startsWith("frame")||e.startsWith("size")){const a=e.split("time=")[1].split(" ")[0],o=Oe(a);ve=o/J,t({ratio:ve,time:o})}else e.startsWith("video:")&&(t({ratio:1}),J=0)},Ft=(e,t)=>{const a=e._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach((o,d)=>{const n=e._malloc(o.length+1);e.writeAsciiToMemory(o,n),e.setValue(a+Uint32Array.BYTES_PER_ELEMENT*d,n,"i32")}),[t.length,a]},$e={exports:{}};(function(e,t){(function(a,o){e.exports=o()})(lt,function(){function a(){var o=arguments.length;if(o===0)throw new Error("resolveUrl requires at least one argument; got none.");var d=document.createElement("base");if(d.href=arguments[0],o===1)return d.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(d,n.firstChild);for(var l=document.createElement("a"),u,c=1;c<o;c++)l.href=arguments[c],u=l.href,d.href=u;return n.removeChild(d),u}return a})})($e);const kt="@ffmpeg/ffmpeg",$t="0.10.1",Et="FFmpeg WebAssembly version",Ct="src/index.js",Lt="src/index.d.ts",St={example:"examples"},Dt={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Pt={"./src/node/index.js":"./src/browser/index.js"},It={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Bt=["ffmpeg","WebAssembly","video"],Ot="Jerome Wu <jeromewus@gmail.com>",At="MIT",jt={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},zt={node:">=12.16.1"},Tt="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Mt={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ut={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var Ne={name:kt,version:$t,description:Et,main:Ct,types:Lt,directories:St,scripts:Dt,browser:Pt,repository:It,keywords:Bt,author:Ot,license:At,bugs:jt,engines:zt,homepage:Tt,dependencies:Mt,devDependencies:Ut};const{devDependencies:Rt}=Ne;var Gt={corePath:`https://unpkg.com/@ffmpeg/core@${Rt["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Vt=$e.exports,{log:K}=qe,he=async(e,t)=>{K("info",`fetch ${e}`);const a=await(await fetch(e)).arrayBuffer();K("info",`${e} file size = ${a.byteLength} bytes`);const o=new Blob([a],{type:t}),d=URL.createObjectURL(o);return K("info",`${e} blob URL = ${d}`),d};var qt=async({corePath:e})=>{if(typeof e!="string")throw Error("corePath should be a string!");const t=Vt(e),a=await he(t,"application/javascript"),o=await he(t.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),d=await he(t.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(n=>{const l=document.createElement("script"),u=()=>{l.removeEventListener("load",u),K("info","ffmpeg-core.js script loaded"),n({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d})};l.src=a,l.type="text/javascript",l.addEventListener("load",u),document.getElementsByTagName("head")[0].appendChild(l)}):(K("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d}))};const Nt=$e.exports,Yt=e=>new Promise((t,a)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:d}}})=>{a(Error(`File could not be read! Code=${d}`))},o.readAsArrayBuffer(e)});var Wt=async e=>{let t=e;return typeof e=="undefined"?new Uint8Array:(typeof e=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(a=>a.charCodeAt(0)):t=await(await fetch(Nt(e))).arrayBuffer():(e instanceof File||e instanceof Blob)&&(t=await Yt(e)),new Uint8Array(t))};const Ht=Gt,Xt=qt,Zt=Wt;var Ye={defaultOptions:Ht,getCreateFFmpegCore:Xt,fetchFile:Zt};const{defaultArgs:Jt,baseOptions:Kt}=bt,{setLogging:Ae,setCustomLogger:je,log:W}=qe,Qt=xt,ea=Ft,{defaultOptions:ta,getCreateFFmpegCore:aa}=Ye,{version:oa}=Ne,me=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var ia=(e={})=>{const y=H(H(H({},Kt),ta),e),{log:t,logger:a,progress:o}=y,d=Ie(y,["log","logger","progress"]);let n=null,l=null,u=null,c=!1,h=o;const m=v=>{v==="FFMPEG_END"&&u!==null&&(u(),u=null,c=!1)},$=({type:v,message:D})=>{W(v,D),Qt(D,h),m(D)},w=async()=>{if(W("info","load ffmpeg-core"),n===null){W("info","loading ffmpeg-core");const{createFFmpegCore:v,corePath:D,workerPath:F,wasmPath:I}=await aa(d);n=await v({mainScriptUrlOrBlob:D,printErr:E=>$({type:"fferr",message:E}),print:E=>$({type:"ffout",message:E}),locateFile:(E,R)=>{if(typeof window!="undefined"){if(typeof I!="undefined"&&E.endsWith("ffmpeg-core.wasm"))return I;if(typeof F!="undefined"&&E.endsWith("ffmpeg-core.worker.js"))return F}return R+E}}),l=n.cwrap("proxy_main","number",["number","number"]),W("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},S=()=>n!==null,U=(...v)=>{if(W("info",`run ffmpeg command: ${v.join(" ")}`),n===null)throw me;if(c)throw Error("ffmpeg.wasm can only run one command at a time");return c=!0,new Promise(D=>{const F=[...Jt,...v].filter(I=>I.length!==0);u=D,l(...ea(n,F))})},T=(v,...D)=>{if(W("info",`run FS.${v} ${D.map(F=>typeof F=="string"?F:`<${F.length} bytes binary file>`).join(" ")}`),n===null)throw me;{let F=null;try{F=n.FS[v](...D)}catch{throw Error(v==="readdir"?`ffmpeg.FS('readdir', '${D[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:v==="readFile"?`ffmpeg.FS('readFile', '${D[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return F}},b=()=>{if(n===null)throw me;c=!1,n.exit(1),n=null,l=null,u=null},_=v=>{h=v},x=v=>{je(v)};return Ae(t),je(a),W("info",`use ffmpeg.wasm v${oa}`),{setProgress:_,setLogger:x,setLogging:Ae,load:w,isLoaded:S,run:U,exit:b,FS:T}};const ra=ia,{fetchFile:na}=Ye;var be={createFFmpeg:ra,fetchFile:na};class sa{constructor(t){q(this,"options");this.options=t}async transforms(t){return Promise.all(t.map(async a=>await this.transform(a)))}async transform(t){const a=await this._loadImg(t.file),o=this._paintFrame({img:a,frame:t});return await this._canvasToBlob(o)}async _canvasToBlob(t){return new Promise(function(a,o){t.toBlob(function(d){d?a(d):o("\u6570\u636E\u5F02\u5E38")},"image/jpeg",1)})}_canvasToImage(t){var a=new Image;return a.src=t.toDataURL("image/png"),a}async _loadImg(t){return new Promise(function(a){const o=new Image;o.src=window.URL.createObjectURL(t),o.onload=function(){a(o)}})}_paintFrame(t){const{width:a,height:o,rule:d,background:n}=this.options,{img:l,frame:u}=t,c=document.createElement("canvas");c.width=a,c.height=o;const h=c.getContext("2d");if(!l||!h)throw new Error("\u6570\u636E\u5F02\u5E38");h.fillStyle=n,h.fillRect(0,0,c.width,c.height);const{canvasData:m,imgData:$}=function(){const{width:F,height:I}=l,{width:E,height:R}=c,G=Math.max(E/F,R/I,1),ae=[Math.floor(E/G),Math.floor(R/G)];return{imgData:[Math.floor((F-ae[0])/2),Math.floor((I-ae[1])/2),Math.floor(E/G),Math.floor(R/G)],canvasData:[0,0,E,R]}}(),[w,S,U,T]=$,[b,_,x,y]=m;h.drawImage(l,w,S,U,T,b,_,x,y);const{rotateY:v}=u;if((v==180?-1:1)==-1){const F=h.getImageData(0,0,x,y),I=h.getImageData(0,0,x,y);h.putImageData(this.canvasDataHRevert(F,I),0,0)}return c}canvasDataHRevert(t,a){for(var o=0,d=t.height;o<d;o++)for(var n=0,l=t.width;n<l;n++)a.data[o*l*4+n*4+0]=t.data[o*l*4+(l-n)*4+0],a.data[o*l*4+n*4+1]=t.data[o*l*4+(l-n)*4+1],a.data[o*l*4+n*4+2]=t.data[o*l*4+(l-n)*4+2],a.data[o*l*4+n*4+3]=t.data[o*l*4+(l-n)*4+3];return a}}class la{constructor(){q(this,"buffer");q(this,"frames");q(this,"options");q(this,"music");q(this,"ffmpeg");q(this,"ratio");this.buffer={gif:null,mp4:null},this.frames=[],this.options={width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5},this.music={start:0},this.ffmpeg=be.createFFmpeg({log:!1}),this.ratio=0}setOpt(t){return this.options=Object.assign(this.options,t),this}setFrame(t){return this.frames=t,this}setMusic(t){return this.music=t,this}logProgress(t,a){if(t<0)return;const o=parseFloat((((a==="gif"?1:0)+t)/2).toFixed(4));o!=this.ratio&&(this.ratio=o,console.log(`\u751F\u6210\u8FDB\u5EA6\uFF1A${this.ratio*100}%`,this.ratio))}async toPreView(){return this.buffer={gif:null,mp4:null},await this._mixinMusic(),this.buffer.mp4?URL.createObjectURL(new Blob([this.buffer.mp4],{type:"video/mp4"})):""}async toFile(t){const a=`${t}-${Te()}.${t}`;let o="";switch(t){case"gif":o="image/gif";break;case"mp4":o="video/mp4";break}if(!this.buffer[t])return"";dt.exports.saveAs(new Blob([this.buffer[t]],{type:o}),a)}_toTime(t){const a=t%60;return`00:${((t-a)/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}async _mixinMusic(){if(this.frames.length==0)return;this.ffmpeg.isLoaded()||await this.ffmpeg.load();const t="out.mp4",a="out.gif",o="music.mp3",{delay:d,quality:n}=this.options,{file:l,start:u}=this.music,c=1e3/d,h=17+Math.round(n*10),m=d/1e3*this.frames.length,w=await new sa(this.options).transforms(this.frames),S=[];if(w.forEach(async(b,_)=>{this.ffmpeg.FS("writeFile",`${_}.jpg`,await be.fetchFile(b)),S.push(`${_}.jpg`)}),this.ffmpeg.setProgress(({ratio:b})=>this.logProgress(b,"mp4")),l){this.ffmpeg.FS("writeFile",o,await be.fetchFile(l));const b=this._toTime(u);await this.ffmpeg.run("-r",`${c}`,"-f","image2","-i","%d.jpg","-i",o,"-ss",b,"-t",`${m}`,"-crf",`${h}`,t)}else await this.ffmpeg.run("-r",`${c}`,"-f","image2","-i","%d.jpg","-crf",`${h}`,t);const U=this.ffmpeg.FS("readFile",t).buffer;this.ffmpeg.setProgress(({ratio:b})=>this.logProgress(b,"gif")),await this.ffmpeg.run("-i",t,a);const T=this.ffmpeg.FS("readFile",a).buffer;S.forEach(b=>this.ffmpeg.FS("unlink",b)),this.buffer={gif:T,mp4:U}}}const te=e=>(Q("data-v-747a75ea"),e=e(),ee(),e),da={class:"form"},ca=te(()=>f("span",null,"\u5BBD / \u9AD8\uFF1A",-1)),ua=te(()=>f("span",null,"\u8D28\u91CF\uFF1A",-1)),fa=te(()=>f("span",{for:"background"},"\u80CC\u666F\u8272\uFF1A",-1)),ga=te(()=>f("span",{for:"delay"},"\u505C\u7559\u65F6\u95F4\uFF1A",-1)),pa=te(()=>f("span",{for:"repeat"},"\u91CD\u590D\u6B21\u6570\uFF1A",-1)),va=N({__name:"gif-canvas",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=L({width:a.value.width,height:a.value.height}),d=function(u){let c=a.value;u&&(c=Object.assign(c,u)),t("update:value",c),t("change")},n=function(u){d(u)},l=function(){d()};return(u,c)=>(P(),B("div",da,[f("div",null,[ca,C(ct,{value:o.value,onChange:n},null,8,["value"])]),f("div",null,[ua,f("div",null,[C(ut,{ref:"scaleRange",value:e.value.quality,"onUpdate:value":c[0]||(c[0]=h=>e.value.quality=h),onChange:l},null,8,["value"])])]),C(Ge),f("div",null,[fa,f("div",null,[ie(f("input",{type:"color",name:"background","onUpdate:modelValue":c[1]||(c[1]=h=>e.value.background=h),onChange:d},null,544),[[re,e.value.background]])])]),f("div",null,[ga,f("div",null,[ie(f("input",{type:"number",name:"delay",min:"0",placeholder:"\u505C\u7559\u65F6\u95F4 \u6BEB\u79D2","onUpdate:modelValue":c[2]||(c[2]=h=>e.value.delay=h),onChange:d},null,544),[[re,e.value.delay]])])]),f("div",null,[pa,f("div",null,[ie(f("input",{type:"number",name:"repeat",min:"-1",placeholder:"-1 never 0 ever or number","onUpdate:modelValue":c[3]||(c[3]=h=>e.value.repeat=h),onChange:d},null,544),[[re,e.value.repeat]])])])]))}});var ha=V(va,[["__scopeId","data-v-747a75ea"]]);const ma=e=>(Q("data-v-7d1fe6f4"),e=e(),ee(),e),ba={class:"form"},ya={class:"music-select"},wa=["onClick"],_a=ma(()=>f("span",null,"\u8D77\u59CB\u65F6\u95F4\uFF1A",-1)),xa=N({__name:"gif-music",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=L([]),d=function(l){let u=a.value;l&&(u=Object.assign(u,l)),t("update:value",u),t("change")},n=function(l){l.selected||(o.value=o.value.map(u=>(u.selected=l.id==u.id,u)),d({file:l.file}))};return(l,u)=>(P(),B("div",ba,[C(ft,{value:o.value,"onUpdate:value":u[0]||(u[0]=c=>o.value=c),max_size:1024*50,file_type:["audio/mpeg"]},null,8,["value"]),f("div",ya,[f("ul",null,[(P(!0),B(xe,null,Me(o.value,c=>(P(),B("li",{class:"line",onClick:h=>n(c)},[f("span",null,Fe(c.file.name),1),f("span",null,[f("i",{class:X(["css-icon",c.selected?"select":""])},null,2)])],8,wa))),256))])]),C(Ge),f("div",null,[_a,f("div",null,[ie(f("input",{type:"number",name:"start","onUpdate:modelValue":u[1]||(u[1]=c=>e.value.start=c),onChange:d},null,544),[[re,e.value.start]])])])]))}});var Fa=V(xa,[["__scopeId","data-v-7d1fe6f4"]]);const ka={class:"list"},$a={class:"img"},Ea=["src"],Ca={class:"tools icon-group"},La=N({__name:"FrameEditor",props:{list:null},setup(e,{expose:t}){const a=e,o=L([]);Qe(a,function(){o.value=a.list.map(l=>{const u=o.value.find(c=>l.id==c.id);return u||Object.assign({rotateX:0,rotateY:0,rotateZ:0},l)})}),t({getFrames:function(){return o.value.map(l=>H({},l))}});const n=function(l){o.value[l].rotateY=o.value[l].rotateY==0?180:0};return(l,u)=>(P(),B("div",ka,[f("ul",null,[(P(!0),B(xe,null,Me(o.value,(c,h)=>(P(),B("li",{key:c.id},[f("div",$a,[f("img",{src:c.src,alt:"",style:et({transform:`rotateX(${c.rotateX}deg) rotateY(${c.rotateY}deg) rotateZ(${c.rotateZ}deg)`})},null,12,Ea),f("span",null,"\u7B2C "+Fe(h+1)+" \u5E27",1)]),f("div",Ca,[C(gt,{type:"flip-x",onClick:m=>n(h)},null,8,["onClick"])])]))),128))])]))}});var Sa=V(La,[["__scopeId","data-v-6e9ce642"]]);const Da={},Pa={class:"dialog-loading global-loading"},Ia=tt('<div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div>',12),Ba=[Ia];function Oa(e,t){return P(),B("div",Pa,Ba)}var Aa=V(Da,[["render",Oa],["__scopeId","data-v-ed30dbd0"]]);const ja=N({__name:"Overlay",props:{show:{type:Boolean,default:!1}},setup(e){return(t,a)=>(P(),B("div",{class:X(["overlay",e.show?"overlay-show":""])},null,2))}});var za=V(ja,[["__scopeId","data-v-07cab184"]]);const Ta=e=>(Q("data-v-19456f35"),e=e(),ee(),e),Ma=["id"],Ua={class:"dialog-center-box"},Ra=Ta(()=>f("span",{class:"css-icon delete bold"},null,-1)),Ga=[Ra],Va={key:1,class:"dialog-header"},qa={class:"dialog-content"},Na={key:2,class:"dialog-footer"},Ya=N({__name:"Dialog",props:{size:{type:String,default:"max-content"},needClose:{type:Boolean,default:!0},show:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:show","update:loading"],setup(e,{emit:t}){const a=L(Ue()),o=at(),d=function(){t("update:show",!1),t("update:loading",!1)};return(n,l)=>(P(),B("div",{id:a.value,class:X(["dialog","dialog-"+e.size,e.show?"open":""])},[C(za,{show:e.show,onClick:d},null,8,["show"]),C(Aa,{class:X(["dialog-loading",e.loading?"show":""])},null,8,["class"]),f("div",Ua,[e.needClose?(P(),B("div",{key:0,class:"dialog-close",onClick:d},Ga)):fe("",!0),Be(o).header?(P(),B("div",Va,[ge(n.$slots,"header",{},void 0,!0)])):fe("",!0),f("div",qa,[ge(n.$slots,"content",{},void 0,!0)]),Be(o).footer?(P(),B("div",Na,[ge(n.$slots,"footer",{},void 0,!0)])):fe("",!0)])],10,Ma))}});var Wa=V(Ya,[["__scopeId","data-v-19456f35"]]);const Ha=["src","width"],Xa={class:"btn-group center"},Za=N({__name:"PreViewDialog",props:{ratio:{type:Number,default:1}},emits:["footer-click"],setup(e,{expose:t,emit:a}){const o=L(""),d=window.screen.height*.6,n=L(!1),l=L(!1),u=function($=!1){n.value=!0,l.value=$};t({display:function($){o.value=$,u()},load:function(){u(!0)},open:u});const m=function($){a("footer-click",$)};return($,w)=>(P(),ot(Wa,{show:n.value,"onUpdate:show":w[2]||(w[2]=S=>n.value=S),loading:l.value,"onUpdate:loading":w[3]||(w[3]=S=>l.value=S)},{content:M(()=>[f("video",{src:o.value,width:d*e.ratio,height:d,class:"preview",controls:"",autoplay:""},null,8,Ha)]),footer:M(()=>[f("div",Xa,[f("button",{class:"button large C",onClick:w[0]||(w[0]=S=>m("gif"))},"\u4E0B\u8F7DGIF"),f("button",{class:"button large C",onClick:w[1]||(w[1]=S=>m("mp4"))},"\u4E0B\u8F7DMP4")])]),_:1},8,["show","loading"]))}});var Ja=V(Za,[["__scopeId","data-v-44d1a161"]]);const We=e=>(Q("data-v-4db207e5"),e=e(),ee(),e),Ka=We(()=>f("span",null,"Pic GIF",-1)),Qa=We(()=>f("button",{class:"button C"},[f("a",{href:"./collage.html"},"Pic Collage")],-1)),eo={class:"left"},to={class:"right"},ao=N({__name:"index",setup(e){const t=L([]),a=L("library"),o=L(""),d=L(),n=L(),l=L(),u=L({width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5}),c=L({start:0}),h=L([]),m=new la,$=it("_message"),w=()=>{nt(()=>{o.value="",d.value.clearSelect(),$({type:"success",value:"\u6E05\u7406\u6210\u529F..."})})},S=x=>{t.value.push({value:x,timestamp:Te()})},U=async function(){var x=l.value.getFrames();if(!x||x.length==0){$({type:"warning",value:"\u8BF7\u4ECE\u56FE\u5E93\u4E2D\u9009\u62E9\u3002"});return}$({value:"\u6B63\u5728\u52A0\u8F7D\u63D2\u4EF6\uFF0C\u8BF7\u7B49\u5F85..."}),n.value.load();var y=await m.setOpt(u.value).setMusic(c.value).setFrame(x).toPreView().catch(v=>console.log(v));n.value.display(y)},T=function(x){var y=l.value.getFrames();!y||y.length==0||m.toFile(x).catch(v=>console.log(v))},b=L([]),_=function(x){b.value=x};return(x,y)=>(P(),B(xe,null,[C(rt,{needLog:!0},{header:M(()=>[Ka]),menu:M(()=>[Qa]),main:M(()=>[f("div",eo,[C(pt,{selected:a.value,"onUpdate:selected":y[1]||(y[1]=v=>a.value=v)},{default:M(()=>[C(pe,{key:"library",title:"\u56FE\u5E93"},{default:M(()=>[C(vt,{ref_key:"galleryLoader",ref:d,value:h.value,"onUpdate:value":y[0]||(y[0]=v=>h.value=v),onLog:S,need_decision:!0,onDecision:_},null,8,["value"])]),_:1}),C(pe,{key:"music",title:"\u97F3\u4E50\u5E93"},{default:M(()=>[C(Fa,{value:c.value},null,8,["value"])]),_:1}),C(pe,{key:"setting",title:"\u8BBE\u7F6E"},{default:M(()=>[C(ha,{value:u.value},null,8,["value"])]),_:1})]),_:1},8,["selected"]),f("div",{class:"btn-group center"},[f("button",{class:"button large",onClick:U},"\u751F\u6210\u9884\u89C8")])]),f("div",to,[f("div",{class:"btn-group right"},[f("button",{class:"button A",onClick:w},"\u6E05\u7406\u5E27")]),C(Sa,{ref_key:"frameEditor",ref:l,list:b.value},null,8,["list"])])]),footer:M(()=>[C(ht,{logs:t.value},null,8,["logs"])]),_:1}),C(Ja,{ref_key:"previewDialog",ref:n,ratio:u.value.width/u.value.height,onFooterClick:T},null,8,["ratio"])],64))}});var oo=V(ao,[["__scopeId","data-v-4db207e5"]]);const io=e=>(Q("data-v-0026c91e"),e=e(),ee(),e),ro=io(()=>f("i",{class:"css-icon delete"},null,-1)),no=[ro],so=N({__name:"Message",props:{type:{type:String,default:"info"},value:{type:String,default:""},timeout:{type:Number,default:3e3},remove:Function},setup(e){const t=e;let a;const o=L(!1);st(()=>{o.value=!0;const n=300;a=setTimeout(function(){o.value=!1,setTimeout(function(){typeof t.remove=="function"&&t.remove()},n)},t.timeout-n)});const d=()=>{typeof t.remove=="function"&&t.remove(),a&&clearTimeout(a)};return(n,l)=>(P(),B("div",{class:X(["global-message-box",o.value?"open":""])},[f("div",{class:X(["global-message-value",e.type])},Fe(e.value),3),f("span",{class:"global-message-btn",onClick:d},no)],2))}});var He=V(so,[["__scopeId","data-v-0026c91e"]]);let ze;const ye={margin:40,zIndex:1e4};let Xe=0,Ee=ye.margin,we=[];const lo=(e,t)=>{we.push(e),e.setAttribute("no",t.toString()),e.classList.add("global_message"),e.style.position="fixed",e.style.right=`${ye.margin}px`,e.style.zIndex=ye.zIndex.toString(),e.style.top=`${Ee}px`},co=(e,t,a)=>{we.forEach((o,d)=>{d>0&&(o.style.top=`${o.offsetTop-we[d-1].offsetHeight}px`)}),Ee-=t.offsetHeight,Xe--,a&&a()},uo=(e,t)=>{const a=e.getAttribute("no");if(!a)return;const o=Re(He,Pe(H({},t),{modelValue:!0,remove(){co(parseInt(a),e,()=>{o.unmount(),document.body.removeChild(e)})}}));return o.mount(e)};function _e(e={}){e.id=`message_${Ue()}`;const t=document.createElement("div");return lo(t,Xe++),document.body.appendChild(t),ze=uo(t,e),Ee+=t.offsetHeight,ze}_e.install=e=>{e.component("message",He),e.provide("_message",_e)};const fo=Re(oo);fo.use(_e).mount("#app");
