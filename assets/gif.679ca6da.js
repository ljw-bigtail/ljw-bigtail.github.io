var Ze=Object.defineProperty,Ke=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ue=(e,t,a)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,H=(e,t)=>{for(var a in t||(t={}))Se.call(t,a)&&ue(e,a,t[a]);if(oe)for(var a of oe(t))De.call(t,a)&&ue(e,a,t[a]);return e},Pe=(e,t)=>Ke(e,Je(t));var Ie=(e,t)=>{var a={};for(var o in e)Se.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(e!=null&&oe)for(var o of oe(e))t.indexOf(o)<0&&De.call(e,o)&&(a[o]=e[o]);return a};var V=(e,t,a)=>(ue(e,typeof t!="symbol"?t+"":t,a),a);import{g as Te,_ as G,d as q,r as C,o as D,h as P,a as f,i as $,j as ie,v as re,p as Q,e as ee,F as Fe,k as Me,t as xe,n as X,l as Qe,m as et,q as tt,u as Ue,s as at,x as fe,y as Be,z as ge,c as ot,w as T,A as it,b as rt,B as nt,C as st,f as Ge}from"./plugin-vue_export-helper.c3c1043c.js";import{c as lt,F as dt,S as ct,R as ut,L as Re,D as ft,I as gt,T as pt,a as pe,G as vt,b as ht}from"./Line.02cf2b9e.js";var mt={exports:{}};(function(e){var t=function(a){var o=Object.prototype,d=o.hasOwnProperty,n,s=typeof Symbol=="function"?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function m(r,i,l){return Object.defineProperty(r,i,{value:l,enumerable:!0,configurable:!0,writable:!0}),r[i]}try{m({},"")}catch{m=function(i,l,p){return i[l]=p}}function y(r,i,l,p){var g=i&&i.prototype instanceof _?i:_,F=Object.create(g.prototype),B=new le(p||[]);return F._invoke=ae(r,l,B),F}a.wrap=y;function E(r,i,l){try{return{type:"normal",arg:r.call(i,l)}}catch(p){return{type:"throw",arg:p}}}var I="suspendedStart",N="suspendedYield",R="executing",j="completed",L={};function _(){}function b(){}function v(){}var x={};m(x,c,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(de([])));S&&S!==o&&d.call(S,c)&&(x=S);var k=v.prototype=_.prototype=Object.create(x);b.prototype=v,m(k,"constructor",v),m(v,"constructor",b),b.displayName=m(v,h,"GeneratorFunction");function M(r){["next","throw","return"].forEach(function(i){m(r,i,function(l){return this._invoke(i,l)})})}a.isGeneratorFunction=function(r){var i=typeof r=="function"&&r.constructor;return i?i===b||(i.displayName||i.name)==="GeneratorFunction":!1},a.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,v):(r.__proto__=v,m(r,h,"GeneratorFunction")),r.prototype=Object.create(k),r},a.awrap=function(r){return{__await:r}};function U(r,i){function l(F,B,z,A){var O=E(r[F],r,B);if(O.type==="throw")A(O.arg);else{var ce=O.arg,Z=ce.value;return Z&&typeof Z=="object"&&d.call(Z,"__await")?i.resolve(Z.__await).then(function(Y){l("next",Y,z,A)},function(Y){l("throw",Y,z,A)}):i.resolve(Z).then(function(Y){ce.value=Y,z(ce)},function(Y){return l("throw",Y,z,A)})}}var p;function g(F,B){function z(){return new i(function(A,O){l(F,B,A,O)})}return p=p?p.then(z,z):z()}this._invoke=g}M(U.prototype),m(U.prototype,u,function(){return this}),a.AsyncIterator=U,a.async=function(r,i,l,p,g){g===void 0&&(g=Promise);var F=new U(y(r,i,l,p),g);return a.isGeneratorFunction(i)?F:F.next().then(function(B){return B.done?B.value:F.next()})};function ae(r,i,l){var p=I;return function(F,B){if(p===R)throw new Error("Generator is already running");if(p===j){if(F==="throw")throw B;return Le()}for(l.method=F,l.arg=B;;){var z=l.delegate;if(z){var A=ne(z,l);if(A){if(A===L)continue;return A}}if(l.method==="next")l.sent=l._sent=l.arg;else if(l.method==="throw"){if(p===I)throw p=j,l.arg;l.dispatchException(l.arg)}else l.method==="return"&&l.abrupt("return",l.arg);p=R;var O=E(r,i,l);if(O.type==="normal"){if(p=l.done?j:N,O.arg===L)continue;return{value:O.arg,done:l.done}}else O.type==="throw"&&(p=j,l.method="throw",l.arg=O.arg)}}}function ne(r,i){var l=r.iterator[i.method];if(l===n){if(i.delegate=null,i.method==="throw"){if(r.iterator.return&&(i.method="return",i.arg=n,ne(r,i),i.method==="throw"))return L;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return L}var p=E(l,r.iterator,i.arg);if(p.type==="throw")return i.method="throw",i.arg=p.arg,i.delegate=null,L;var g=p.arg;if(!g)return i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,L;if(g.done)i[r.resultName]=g.value,i.next=r.nextLoc,i.method!=="return"&&(i.method="next",i.arg=n);else return g;return i.delegate=null,L}M(k),m(k,h,"Generator"),m(k,c,function(){return this}),m(k,"toString",function(){return"[object Generator]"});function Ce(r){var i={tryLoc:r[0]};1 in r&&(i.catchLoc=r[1]),2 in r&&(i.finallyLoc=r[2],i.afterLoc=r[3]),this.tryEntries.push(i)}function se(r){var i=r.completion||{};i.type="normal",delete i.arg,r.completion=i}function le(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Ce,this),this.reset(!0)}a.keys=function(r){var i=[];for(var l in r)i.push(l);return i.reverse(),function p(){for(;i.length;){var g=i.pop();if(g in r)return p.value=g,p.done=!1,p}return p.done=!0,p}};function de(r){if(r){var i=r[c];if(i)return i.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var l=-1,p=function g(){for(;++l<r.length;)if(d.call(r,l))return g.value=r[l],g.done=!1,g;return g.value=n,g.done=!0,g};return p.next=p}}return{next:Le}}a.values=de;function Le(){return{value:n,done:!0}}return le.prototype={constructor:le,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(se),!r)for(var i in this)i.charAt(0)==="t"&&d.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=n)},stop:function(){this.done=!0;var r=this.tryEntries[0],i=r.completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function l(A,O){return F.type="throw",F.arg=r,i.next=A,O&&(i.method="next",i.arg=n),!!O}for(var p=this.tryEntries.length-1;p>=0;--p){var g=this.tryEntries[p],F=g.completion;if(g.tryLoc==="root")return l("end");if(g.tryLoc<=this.prev){var B=d.call(g,"catchLoc"),z=d.call(g,"finallyLoc");if(B&&z){if(this.prev<g.catchLoc)return l(g.catchLoc,!0);if(this.prev<g.finallyLoc)return l(g.finallyLoc)}else if(B){if(this.prev<g.catchLoc)return l(g.catchLoc,!0)}else if(z){if(this.prev<g.finallyLoc)return l(g.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,i){for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l];if(p.tryLoc<=this.prev&&d.call(p,"finallyLoc")&&this.prev<p.finallyLoc){var g=p;break}}g&&(r==="break"||r==="continue")&&g.tryLoc<=i&&i<=g.finallyLoc&&(g=null);var F=g?g.completion:{};return F.type=r,F.arg=i,g?(this.method="next",this.next=g.finallyLoc,L):this.complete(F)},complete:function(r,i){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&i&&(this.next=i),L},finish:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var l=this.tryEntries[i];if(l.finallyLoc===r)return this.complete(l.completion,l.afterLoc),se(l),L}},catch:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var l=this.tryEntries[i];if(l.tryLoc===r){var p=l.completion;if(p.type==="throw"){var g=p.arg;se(l)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(r,i,l){return this.delegate={iterator:de(r),resultName:i,nextLoc:l},this.method==="next"&&(this.arg=n),L}},a}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(mt);var bt={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let ke=!1,Ve=()=>{};const yt=e=>{ke=e},wt=e=>{Ve=e},_t=(e,t)=>{Ve({type:e,message:t}),ke&&console.log(`[${e}] ${t}`)};var qe={logging:ke,setLogging:yt,setCustomLogger:wt,log:_t};let K=0,ve=0;const ze=e=>{const[t,a,o]=e.split(":");return parseFloat(t)*60*60+parseFloat(a)*60+parseFloat(o)};var Ft=(e,t)=>{if(typeof e=="string")if(e.startsWith("  Duration")){const a=e.split(", ")[0].split(": ")[1],o=ze(a);t({duration:o,ratio:ve}),(K===0||K>o)&&(K=o)}else if(e.startsWith("frame")||e.startsWith("size")){const a=e.split("time=")[1].split(" ")[0],o=ze(a);ve=o/K,t({ratio:ve,time:o})}else e.startsWith("video:")&&(t({ratio:1}),K=0)},xt=(e,t)=>{const a=e._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach((o,d)=>{const n=e._malloc(o.length+1);e.writeAsciiToMemory(o,n),e.setValue(a+Uint32Array.BYTES_PER_ELEMENT*d,n,"i32")}),[t.length,a]},$e={exports:{}};(function(e,t){(function(a,o){e.exports=o()})(lt,function(){function a(){var o=arguments.length;if(o===0)throw new Error("resolveUrl requires at least one argument; got none.");var d=document.createElement("base");if(d.href=arguments[0],o===1)return d.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(d,n.firstChild);for(var s=document.createElement("a"),c,u=1;u<o;u++)s.href=arguments[u],c=s.href,d.href=c;return n.removeChild(d),c}return a})})($e);const kt="@ffmpeg/ffmpeg",$t="0.10.1",Et="FFmpeg WebAssembly version",Ct="src/index.js",Lt="src/index.d.ts",St={example:"examples"},Dt={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Pt={"./src/node/index.js":"./src/browser/index.js"},It={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Bt=["ffmpeg","WebAssembly","video"],zt="Jerome Wu <jeromewus@gmail.com>",Ot="MIT",At={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},jt={node:">=12.16.1"},Tt="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Mt={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ut={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var Ne={name:kt,version:$t,description:Et,main:Ct,types:Lt,directories:St,scripts:Dt,browser:Pt,repository:It,keywords:Bt,author:zt,license:Ot,bugs:At,engines:jt,homepage:Tt,dependencies:Mt,devDependencies:Ut};const{devDependencies:Gt}=Ne;var Rt={corePath:`https://unpkg.com/@ffmpeg/core@${Gt["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Vt=$e.exports,{log:J}=qe,he=async(e,t)=>{J("info",`fetch ${e}`);const a=await(await fetch(e)).arrayBuffer();J("info",`${e} file size = ${a.byteLength} bytes`);const o=new Blob([a],{type:t}),d=URL.createObjectURL(o);return J("info",`${e} blob URL = ${d}`),d};var qt=async({corePath:e})=>{if(typeof e!="string")throw Error("corePath should be a string!");const t=Vt(e),a=await he(t,"application/javascript"),o=await he(t.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),d=await he(t.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(n=>{const s=document.createElement("script"),c=()=>{s.removeEventListener("load",c),J("info","ffmpeg-core.js script loaded"),n({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d})};s.src=a,s.type="text/javascript",s.addEventListener("load",c),document.getElementsByTagName("head")[0].appendChild(s)}):(J("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d}))};const Nt=$e.exports,Yt=e=>new Promise((t,a)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:d}}})=>{a(Error(`File could not be read! Code=${d}`))},o.readAsArrayBuffer(e)});var Wt=async e=>{let t=e;return typeof e=="undefined"?new Uint8Array:(typeof e=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(a=>a.charCodeAt(0)):t=await(await fetch(Nt(e))).arrayBuffer():(e instanceof File||e instanceof Blob)&&(t=await Yt(e)),new Uint8Array(t))};const Ht=Rt,Xt=qt,Zt=Wt;var Ye={defaultOptions:Ht,getCreateFFmpegCore:Xt,fetchFile:Zt};const{defaultArgs:Kt,baseOptions:Jt}=bt,{setLogging:Oe,setCustomLogger:Ae,log:W}=qe,Qt=Ft,ea=xt,{defaultOptions:ta,getCreateFFmpegCore:aa}=Ye,{version:oa}=Ne,me=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var ia=(e={})=>{const b=H(H(H({},Jt),ta),e),{log:t,logger:a,progress:o}=b,d=Ie(b,["log","logger","progress"]);let n=null,s=null,c=null,u=!1,h=o;const m=v=>{v==="FFMPEG_END"&&c!==null&&(c(),c=null,u=!1)},y=({type:v,message:x})=>{W(v,x),Qt(x,h),m(x)},E=async()=>{if(W("info","load ffmpeg-core"),n===null){W("info","loading ffmpeg-core");const{createFFmpegCore:v,corePath:x,workerPath:w,wasmPath:S}=await aa(d);n=await v({mainScriptUrlOrBlob:x,printErr:k=>y({type:"fferr",message:k}),print:k=>y({type:"ffout",message:k}),locateFile:(k,M)=>{if(typeof window!="undefined"){if(typeof S!="undefined"&&k.endsWith("ffmpeg-core.wasm"))return S;if(typeof w!="undefined"&&k.endsWith("ffmpeg-core.worker.js"))return w}return M+k}}),s=n.cwrap("proxy_main","number",["number","number"]),W("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},I=()=>n!==null,N=(...v)=>{if(W("info",`run ffmpeg command: ${v.join(" ")}`),n===null)throw me;if(u)throw Error("ffmpeg.wasm can only run one command at a time");return u=!0,new Promise(x=>{const w=[...Kt,...v].filter(S=>S.length!==0);c=x,s(...ea(n,w))})},R=(v,...x)=>{if(W("info",`run FS.${v} ${x.map(w=>typeof w=="string"?w:`<${w.length} bytes binary file>`).join(" ")}`),n===null)throw me;{let w=null;try{w=n.FS[v](...x)}catch{throw Error(v==="readdir"?`ffmpeg.FS('readdir', '${x[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:v==="readFile"?`ffmpeg.FS('readFile', '${x[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return w}},j=()=>{if(n===null)throw me;u=!1,n.exit(1),n=null,s=null,c=null},L=v=>{h=v},_=v=>{Ae(v)};return Oe(t),Ae(a),W("info",`use ffmpeg.wasm v${oa}`),{setProgress:L,setLogger:_,setLogging:Oe,load:E,isLoaded:I,run:N,exit:j,FS:R}};const ra=ia,{fetchFile:na}=Ye;var be={createFFmpeg:ra,fetchFile:na};class sa{constructor(t){V(this,"options");this.options=t}async transforms(t){return Promise.all(t.map(async a=>{const o=await this._loadImg(a.file),d=this._paintFrame({img:o,frame:a});return await this._canvasToBlob(d)}))}async transformsCanvas(t){return Promise.all(t.map(async a=>{const o=await this._loadImg(a.file);return this._paintFrame({img:o,frame:a})}))}async _canvasToBlob(t){return new Promise(function(a,o){t.toBlob(function(d){d?a(d):o("\u6570\u636E\u5F02\u5E38")},"image/jpeg",1)})}_canvasToImage(t){var a=new Image;return a.src=t.toDataURL("image/png"),a}async _loadImg(t){return new Promise(function(a){const o=new Image;o.src=window.URL.createObjectURL(t),o.onload=function(){a(o)}})}_paintFrame(t){const{width:a,height:o,rule:d,background:n}=this.options,{img:s,frame:c}=t,u=document.createElement("canvas");u.width=a,u.height=o;const h=u.getContext("2d");if(!s||!h)throw new Error("\u6570\u636E\u5F02\u5E38");h.fillStyle=n,h.fillRect(0,0,u.width,u.height);const{canvasData:m,imgData:y}=function(){const{width:w,height:S}=s,{width:k,height:M}=u,U=Math.max(k/w,M/S,1),ae=[Math.floor(k/U),Math.floor(M/U)];return{imgData:[Math.floor((w-ae[0])/2),Math.floor((S-ae[1])/2),Math.floor(k/U),Math.floor(M/U)],canvasData:[0,0,k,M]}}(),[E,I,N,R]=y,[j,L,_,b]=m;h.drawImage(s,E,I,N,R,j,L,_,b);const{rotateY:v}=c;if((v==180?-1:1)==-1){const w=h.getImageData(0,0,_,b),S=h.getImageData(0,0,_,b);h.putImageData(this.canvasDataHRevert(w,S),0,0)}return u}canvasDataHRevert(t,a){for(var o=0,d=t.height;o<d;o++)for(var n=0,s=t.width;n<s;n++)a.data[o*s*4+n*4+0]=t.data[o*s*4+(s-n)*4+0],a.data[o*s*4+n*4+1]=t.data[o*s*4+(s-n)*4+1],a.data[o*s*4+n*4+2]=t.data[o*s*4+(s-n)*4+2],a.data[o*s*4+n*4+3]=t.data[o*s*4+(s-n)*4+3];return a}}class la{constructor(){V(this,"file");V(this,"frames");V(this,"options");V(this,"music");V(this,"ffmpeg");V(this,"ratio");this.file={gif:null,mp4:null},this.frames=[],this.options={width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5},this.music={start:0},this.ffmpeg=be.createFFmpeg({log:!1}),this.ratio=0}setOpt(t){return this.options=Object.assign(this.options,t),this}setFrame(t){return this.frames=t,this}setMusic(t){return this.music=t,this}logProgress(t,a){if(t<0)return;const o=parseFloat((((a==="gif"?1:0)+t)/2).toFixed(4));o!=this.ratio&&(this.ratio=o,console.log(`\u751F\u6210\u8FDB\u5EA6\uFF1A${this.ratio*100}%`,this.ratio))}async toPreView(){if(this.file={gif:null,mp4:null},this.frames.length==0)return;const a=await new sa(this.options).transforms(this.frames);return this.ffmpeg.isLoaded()||await this.ffmpeg.load(),await this._makeFile(a),!this.file.mp4||!this.file.gif?{}:{src:URL.createObjectURL(this.file.mp4),size_mp4:this.file.mp4.size,size_gif:this.file.gif.size}}async toFile(t){const a=`${t}-${Te()}.${t}`;let o=null;switch(t){case"gif":o=this.file.gif;break;case"mp4":o=this.file.mp4;break}!o||dt.exports.saveAs(o,a)}_toTime(t){const a=t%60;return`00:${((t-a)/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}async _makeFile(t){const a=[];t.forEach(async(o,d)=>{this.ffmpeg.FS("writeFile",`${d}.jpg`,await be.fetchFile(o)),a.push(`${d}.jpg`)}),await this._makeMP4(),await this._makeGIF(),a.forEach(o=>this.ffmpeg.FS("unlink",o))}async _makeMP4(){const t="out.mp4",a="music.mp3",{delay:o,quality:d}=this.options,{file:n,start:s}=this.music,c=1e3/o,u=8+Math.round((1-d)*20),h=o/1e3*this.frames.length;if(this.ffmpeg.setProgress(({ratio:y})=>this.logProgress(y,"mp4")),n){this.ffmpeg.FS("writeFile",a,await be.fetchFile(n));const y=this._toTime(s);await this.ffmpeg.run("-r",`${c}`,"-f","image2","-i","%d.jpg","-i",a,"-ss",y,"-t",`${h}`,"-crf",`${u}`,t)}else await this.ffmpeg.run("-r",`${c}`,"-f","image2","-i","%d.jpg","-crf",`${u}`,t);const m=this.ffmpeg.FS("readFile",t).buffer;this.file.mp4=new Blob([m],{type:"video/mp4"})}async _makeGIF(){const t="out.mp4",a="out.gif",{repeat:o}=this.options,d=o==-1?1:0;this.ffmpeg.setProgress(({ratio:s})=>this.logProgress(s,"gif")),await this.ffmpeg.run("-i",t,"-loop",`${d}`,"-vf","split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse",a);const n=this.ffmpeg.FS("readFile",a).buffer;this.file.gif=new Blob([n],{type:"image/gif"})}}const te=e=>(Q("data-v-747a75ea"),e=e(),ee(),e),da={class:"form"},ca=te(()=>f("span",null,"\u5BBD / \u9AD8\uFF1A",-1)),ua=te(()=>f("span",null,"\u8D28\u91CF\uFF1A",-1)),fa=te(()=>f("span",{for:"background"},"\u80CC\u666F\u8272\uFF1A",-1)),ga=te(()=>f("span",{for:"delay"},"\u505C\u7559\u65F6\u95F4\uFF1A",-1)),pa=te(()=>f("span",{for:"repeat"},"\u91CD\u590D\u6B21\u6570\uFF1A",-1)),va=q({__name:"gif-canvas",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=C({width:a.value.width,height:a.value.height}),d=function(c){let u=a.value;c&&(u=Object.assign(u,c)),t("update:value",u),t("change")},n=function(c){d(c)},s=function(){d()};return(c,u)=>(D(),P("div",da,[f("div",null,[ca,$(ct,{value:o.value,onChange:n},null,8,["value"])]),f("div",null,[ua,f("div",null,[$(ut,{ref:"scaleRange",value:e.value.quality,"onUpdate:value":u[0]||(u[0]=h=>e.value.quality=h),onChange:s},null,8,["value"])])]),$(Re),f("div",null,[fa,f("div",null,[ie(f("input",{type:"color",name:"background","onUpdate:modelValue":u[1]||(u[1]=h=>e.value.background=h),onChange:d},null,544),[[re,e.value.background]])])]),f("div",null,[ga,f("div",null,[ie(f("input",{type:"number",name:"delay",min:"0",placeholder:"\u505C\u7559\u65F6\u95F4 \u6BEB\u79D2","onUpdate:modelValue":u[2]||(u[2]=h=>e.value.delay=h),onChange:d},null,544),[[re,e.value.delay]])])]),f("div",null,[pa,f("div",null,[ie(f("input",{type:"number",name:"repeat",min:"-1",placeholder:"-1 never 0 ever or number","onUpdate:modelValue":u[3]||(u[3]=h=>e.value.repeat=h),onChange:d},null,544),[[re,e.value.repeat]])])])]))}});var ha=G(va,[["__scopeId","data-v-747a75ea"]]);const ma=e=>(Q("data-v-7d1fe6f4"),e=e(),ee(),e),ba={class:"form"},ya={class:"music-select"},wa=["onClick"],_a=ma(()=>f("span",null,"\u8D77\u59CB\u65F6\u95F4\uFF1A",-1)),Fa=q({__name:"gif-music",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=C([]),d=function(s){let c=a.value;s&&(c=Object.assign(c,s)),t("update:value",c),t("change")},n=function(s){s.selected||(o.value=o.value.map(c=>(c.selected=s.id==c.id,c)),d({file:s.file}))};return(s,c)=>(D(),P("div",ba,[$(ft,{value:o.value,"onUpdate:value":c[0]||(c[0]=u=>o.value=u),max_size:1024*50,file_type:["audio/mpeg"]},null,8,["value"]),f("div",ya,[f("ul",null,[(D(!0),P(Fe,null,Me(o.value,u=>(D(),P("li",{class:"line",onClick:h=>n(u)},[f("span",null,xe(u.file.name),1),f("span",null,[f("i",{class:X(["css-icon",u.selected?"select":""])},null,2)])],8,wa))),256))])]),$(Re),f("div",null,[_a,f("div",null,[ie(f("input",{type:"number",name:"start","onUpdate:modelValue":c[1]||(c[1]=u=>e.value.start=u),onChange:d},null,544),[[re,e.value.start]])])])]))}});var xa=G(Fa,[["__scopeId","data-v-7d1fe6f4"]]);const ka={class:"list"},$a={class:"img"},Ea=["src"],Ca={class:"tools icon-group"},La=q({__name:"FrameEditor",props:{list:null},setup(e,{expose:t}){const a=e,o=C([]);Qe(a,function(){o.value=a.list.map(s=>{const c=o.value.find(u=>s.id==u.id);return c||Object.assign({rotateX:0,rotateY:0,rotateZ:0},s)})}),t({getFrames:function(){return o.value.map(s=>H({},s))}});const n=function(s){o.value[s].rotateY=o.value[s].rotateY==0?180:0};return(s,c)=>(D(),P("div",ka,[f("ul",null,[(D(!0),P(Fe,null,Me(o.value,(u,h)=>(D(),P("li",{key:u.id},[f("div",$a,[f("img",{src:u.src,alt:"",style:et({transform:`rotateX(${u.rotateX}deg) rotateY(${u.rotateY}deg) rotateZ(${u.rotateZ}deg)`})},null,12,Ea),f("span",null,"\u7B2C "+xe(h+1)+" \u5E27",1)]),f("div",Ca,[$(gt,{type:"flip-x",onClick:m=>n(h)},null,8,["onClick"])])]))),128))])]))}});var Sa=G(La,[["__scopeId","data-v-6e9ce642"]]);const Da={},Pa={class:"dialog-loading global-loading"},Ia=tt('<div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div>',12),Ba=[Ia];function za(e,t){return D(),P("div",Pa,Ba)}var Oa=G(Da,[["render",za],["__scopeId","data-v-ed30dbd0"]]);const Aa=q({__name:"Overlay",props:{show:{type:Boolean,default:!1}},setup(e){return(t,a)=>(D(),P("div",{class:X(["overlay",e.show?"overlay-show":""])},null,2))}});var ja=G(Aa,[["__scopeId","data-v-07cab184"]]);const Ta=e=>(Q("data-v-19456f35"),e=e(),ee(),e),Ma=["id"],Ua={class:"dialog-center-box"},Ga=Ta(()=>f("span",{class:"css-icon delete bold"},null,-1)),Ra=[Ga],Va={key:1,class:"dialog-header"},qa={class:"dialog-content"},Na={key:2,class:"dialog-footer"},Ya=q({__name:"Dialog",props:{size:{type:String,default:"max-content"},needClose:{type:Boolean,default:!0},show:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:show","update:loading"],setup(e,{emit:t}){const a=C(Ue()),o=at(),d=function(){t("update:show",!1),t("update:loading",!1)};return(n,s)=>(D(),P("div",{id:a.value,class:X(["dialog","dialog-"+e.size,e.show?"open":""])},[$(ja,{show:e.show,onClick:d},null,8,["show"]),$(Oa,{class:X(["dialog-loading",e.loading?"show":""])},null,8,["class"]),f("div",Ua,[e.needClose?(D(),P("div",{key:0,class:"dialog-close",onClick:d},Ra)):fe("",!0),Be(o).header?(D(),P("div",Va,[ge(n.$slots,"header",{},void 0,!0)])):fe("",!0),f("div",qa,[ge(n.$slots,"content",{},void 0,!0)]),Be(o).footer?(D(),P("div",Na,[ge(n.$slots,"footer",{},void 0,!0)])):fe("",!0)])],10,Ma))}});var Wa=G(Ya,[["__scopeId","data-v-19456f35"]]);const Ha=["src","width"],Xa={class:"btn-group center"},Za=q({__name:"PreViewDialog",props:{ratio:{type:Number,default:1}},emits:["footer-click"],setup(e,{expose:t,emit:a}){const o=C(""),d=window.screen.height*.6,n=C(!1),s=C(!1),c=function(y=!1){n.value=!0,s.value=y};t({display:function(y){o.value=y,c()},load:function(){c(!0)},open:c});const m=function(y){a("footer-click",y)};return(y,E)=>(D(),ot(Wa,{show:n.value,"onUpdate:show":E[2]||(E[2]=I=>n.value=I),loading:s.value,"onUpdate:loading":E[3]||(E[3]=I=>s.value=I)},{content:T(()=>[f("video",{src:o.value,width:d*e.ratio,height:d,class:"preview",controls:"",autoplay:""},null,8,Ha)]),footer:T(()=>[f("div",Xa,[f("button",{class:"button large C",onClick:E[0]||(E[0]=I=>m("gif"))},"\u4E0B\u8F7DGIF"),f("button",{class:"button large C",onClick:E[1]||(E[1]=I=>m("mp4"))},"\u4E0B\u8F7DMP4")])]),_:1},8,["show","loading"]))}});var Ka=G(Za,[["__scopeId","data-v-44d1a161"]]);const We=e=>(Q("data-v-52719f86"),e=e(),ee(),e),Ja=We(()=>f("span",null,"Pic GIF",-1)),Qa=We(()=>f("button",{class:"button C"},[f("a",{href:"./collage.html"},"Pic Collage")],-1)),eo={class:"left"},to={class:"right"},ao=q({__name:"index",setup(e){const t=C([]),a=C("library"),o=C(""),d=C(),n=C(),s=C(),c=C({width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5}),u=C({start:0}),h=C([]),m=new la,y=it("_message"),E=()=>{nt(()=>{o.value="",d.value.clearSelect(),y({type:"success",value:"\u6E05\u7406\u6210\u529F..."})})},I=_=>{t.value.push({value:_,timestamp:Te()})},N=async function(){var _=s.value.getFrames();if(!_||_.length==0){y({type:"warning",value:"\u8BF7\u4ECE\u56FE\u5E93\u4E2D\u9009\u62E9\u3002"});return}y({value:"\u6B63\u5728\u52A0\u8F7D\u63D2\u4EF6\uFF0C\u8BF7\u7B49\u5F85..."}),n.value.load();const b=await m.setOpt(c.value).setMusic(u.value).setFrame(_).toPreView().catch(S=>console.log(S));if(!(b!=null&&b.src))return;const{src:v,size_mp4:x,size_gif:w}=b;console.log(`
    size_mp4: ${Math.round(x/1024)}KB
    size_gif: ${Math.round(w/1024)}KB
  `),n.value.display(v)},R=function(_){var b=s.value.getFrames();!b||b.length==0||m.toFile(_).catch(v=>console.log(v))},j=C([]),L=function(_){j.value=_};return(_,b)=>(D(),P(Fe,null,[$(rt,{needLog:!0},{header:T(()=>[Ja]),menu:T(()=>[Qa]),main:T(()=>[f("div",eo,[$(pt,{selected:a.value,"onUpdate:selected":b[1]||(b[1]=v=>a.value=v)},{default:T(()=>[$(pe,{key:"library",title:"\u56FE\u5E93"},{default:T(()=>[$(vt,{ref_key:"galleryLoader",ref:d,value:h.value,"onUpdate:value":b[0]||(b[0]=v=>h.value=v),onLog:I,need_decision:!0,onDecision:L},null,8,["value"])]),_:1}),$(pe,{key:"music",title:"\u97F3\u4E50\u5E93"},{default:T(()=>[$(xa,{value:u.value},null,8,["value"])]),_:1}),$(pe,{key:"setting",title:"\u8BBE\u7F6E"},{default:T(()=>[$(ha,{value:c.value},null,8,["value"])]),_:1})]),_:1},8,["selected"]),f("div",{class:"btn-group center"},[f("button",{class:"button large",onClick:N},"\u751F\u6210\u9884\u89C8")])]),f("div",to,[f("div",{class:"btn-group right"},[f("button",{class:"button A",onClick:E},"\u6E05\u7406\u5E27")]),$(Sa,{ref_key:"frameEditor",ref:s,list:j.value},null,8,["list"])])]),footer:T(()=>[$(ht,{logs:t.value},null,8,["logs"])]),_:1}),$(Ka,{ref_key:"previewDialog",ref:n,ratio:c.value.width/c.value.height,onFooterClick:R},null,8,["ratio"])],64))}});var oo=G(ao,[["__scopeId","data-v-52719f86"]]);const io=e=>(Q("data-v-0026c91e"),e=e(),ee(),e),ro=io(()=>f("i",{class:"css-icon delete"},null,-1)),no=[ro],so=q({__name:"Message",props:{type:{type:String,default:"info"},value:{type:String,default:""},timeout:{type:Number,default:3e3},remove:Function},setup(e){const t=e;let a;const o=C(!1);st(()=>{o.value=!0;const n=300;a=setTimeout(function(){o.value=!1,setTimeout(function(){typeof t.remove=="function"&&t.remove()},n)},t.timeout-n)});const d=()=>{typeof t.remove=="function"&&t.remove(),a&&clearTimeout(a)};return(n,s)=>(D(),P("div",{class:X(["global-message-box",o.value?"open":""])},[f("div",{class:X(["global-message-value",e.type])},xe(e.value),3),f("span",{class:"global-message-btn",onClick:d},no)],2))}});var He=G(so,[["__scopeId","data-v-0026c91e"]]);let je;const ye={margin:40,zIndex:1e4};let Xe=0,Ee=ye.margin,we=[];const lo=(e,t)=>{we.push(e),e.setAttribute("no",t.toString()),e.classList.add("global_message"),e.style.position="fixed",e.style.right=`${ye.margin}px`,e.style.zIndex=ye.zIndex.toString(),e.style.top=`${Ee}px`},co=(e,t,a)=>{we.forEach((o,d)=>{d>0&&(o.style.top=`${o.offsetTop-we[d-1].offsetHeight}px`)}),Ee-=t.offsetHeight,Xe--,a&&a()},uo=(e,t)=>{const a=e.getAttribute("no");if(!a)return;const o=Ge(He,Pe(H({},t),{modelValue:!0,remove(){co(parseInt(a),e,()=>{o.unmount(),document.body.removeChild(e)})}}));return o.mount(e)};function _e(e={}){e.id=`message_${Ue()}`;const t=document.createElement("div");return lo(t,Xe++),document.body.appendChild(t),je=uo(t,e),Ee+=t.offsetHeight,je}_e.install=e=>{e.component("message",He),e.provide("_message",_e)};const fo=Ge(oo);fo.use(_e).mount("#app");
