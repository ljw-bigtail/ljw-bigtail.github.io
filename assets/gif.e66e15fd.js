var Ze=Object.defineProperty,Ke=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ue=(e,t,a)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,H=(e,t)=>{for(var a in t||(t={}))Se.call(t,a)&&ue(e,a,t[a]);if(oe)for(var a of oe(t))De.call(t,a)&&ue(e,a,t[a]);return e},Pe=(e,t)=>Ke(e,Je(t));var Be=(e,t)=>{var a={};for(var o in e)Se.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(e!=null&&oe)for(var o of oe(e))t.indexOf(o)<0&&De.call(e,o)&&(a[o]=e[o]);return a};var V=(e,t,a)=>(ue(e,typeof t!="symbol"?t+"":t,a),a);import{g as Te,_ as q,d as N,r as L,o as D,h as B,a as f,i as C,j as ie,v as re,p as Q,e as ee,F as xe,k as Me,t as Fe,n as X,l as Qe,m as et,q as tt,u as Ue,s as at,x as fe,y as Ie,z as ge,c as ot,w as M,A as it,b as rt,B as nt,C as st,f as Re}from"./plugin-vue_export-helper.c3c1043c.js";import{c as lt,F as dt,S as ct,R as ut,L as Ge,D as ft,I as gt,T as pt,a as pe,G as vt,b as ht}from"./Line.02cf2b9e.js";var mt={exports:{}};(function(e){var t=function(a){var o=Object.prototype,d=o.hasOwnProperty,n,l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",u=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function y(r,i,s){return Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}),r[i]}try{y({},"")}catch{y=function(i,s,p){return i[s]=p}}function _(r,i,s,p){var g=i&&i.prototype instanceof m?i:m,F=Object.create(g.prototype),I=new le(p||[]);return F._invoke=ae(r,s,I),F}a.wrap=_;function x(r,i,s){try{return{type:"normal",arg:r.call(i,s)}}catch(p){return{type:"throw",arg:p}}}var P="suspendedStart",U="suspendedYield",T="executing",A="completed",k={};function m(){}function b(){}function v(){}var $={};y($,c,function(){return this});var w=Object.getPrototypeOf,S=w&&w(w(de([])));S&&S!==o&&d.call(S,c)&&($=S);var E=v.prototype=m.prototype=Object.create($);b.prototype=v,y(E,"constructor",v),y(v,"constructor",b),b.displayName=y(v,h,"GeneratorFunction");function R(r){["next","throw","return"].forEach(function(i){y(r,i,function(s){return this._invoke(i,s)})})}a.isGeneratorFunction=function(r){var i=typeof r=="function"&&r.constructor;return i?i===b||(i.displayName||i.name)==="GeneratorFunction":!1},a.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,v):(r.__proto__=v,y(r,h,"GeneratorFunction")),r.prototype=Object.create(E),r},a.awrap=function(r){return{__await:r}};function G(r,i){function s(F,I,z,j){var O=x(r[F],r,I);if(O.type==="throw")j(O.arg);else{var ce=O.arg,Z=ce.value;return Z&&typeof Z=="object"&&d.call(Z,"__await")?i.resolve(Z.__await).then(function(Y){s("next",Y,z,j)},function(Y){s("throw",Y,z,j)}):i.resolve(Z).then(function(Y){ce.value=Y,z(ce)},function(Y){return s("throw",Y,z,j)})}}var p;function g(F,I){function z(){return new i(function(j,O){s(F,I,j,O)})}return p=p?p.then(z,z):z()}this._invoke=g}R(G.prototype),y(G.prototype,u,function(){return this}),a.AsyncIterator=G,a.async=function(r,i,s,p,g){g===void 0&&(g=Promise);var F=new G(_(r,i,s,p),g);return a.isGeneratorFunction(i)?F:F.next().then(function(I){return I.done?I.value:F.next()})};function ae(r,i,s){var p=P;return function(F,I){if(p===T)throw new Error("Generator is already running");if(p===A){if(F==="throw")throw I;return Le()}for(s.method=F,s.arg=I;;){var z=s.delegate;if(z){var j=ne(z,s);if(j){if(j===k)continue;return j}}if(s.method==="next")s.sent=s._sent=s.arg;else if(s.method==="throw"){if(p===P)throw p=A,s.arg;s.dispatchException(s.arg)}else s.method==="return"&&s.abrupt("return",s.arg);p=T;var O=x(r,i,s);if(O.type==="normal"){if(p=s.done?A:U,O.arg===k)continue;return{value:O.arg,done:s.done}}else O.type==="throw"&&(p=A,s.method="throw",s.arg=O.arg)}}}function ne(r,i){var s=r.iterator[i.method];if(s===n){if(i.delegate=null,i.method==="throw"){if(r.iterator.return&&(i.method="return",i.arg=n,ne(r,i),i.method==="throw"))return k;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var p=x(s,r.iterator,i.arg);if(p.type==="throw")return i.method="throw",i.arg=p.arg,i.delegate=null,k;var g=p.arg;if(!g)return i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,k;if(g.done)i[r.resultName]=g.value,i.next=r.nextLoc,i.method!=="return"&&(i.method="next",i.arg=n);else return g;return i.delegate=null,k}R(E),y(E,h,"Generator"),y(E,c,function(){return this}),y(E,"toString",function(){return"[object Generator]"});function Ce(r){var i={tryLoc:r[0]};1 in r&&(i.catchLoc=r[1]),2 in r&&(i.finallyLoc=r[2],i.afterLoc=r[3]),this.tryEntries.push(i)}function se(r){var i=r.completion||{};i.type="normal",delete i.arg,r.completion=i}function le(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(Ce,this),this.reset(!0)}a.keys=function(r){var i=[];for(var s in r)i.push(s);return i.reverse(),function p(){for(;i.length;){var g=i.pop();if(g in r)return p.value=g,p.done=!1,p}return p.done=!0,p}};function de(r){if(r){var i=r[c];if(i)return i.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var s=-1,p=function g(){for(;++s<r.length;)if(d.call(r,s))return g.value=r[s],g.done=!1,g;return g.value=n,g.done=!0,g};return p.next=p}}return{next:Le}}a.values=de;function Le(){return{value:n,done:!0}}return le.prototype={constructor:le,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(se),!r)for(var i in this)i.charAt(0)==="t"&&d.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=n)},stop:function(){this.done=!0;var r=this.tryEntries[0],i=r.completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var i=this;function s(j,O){return F.type="throw",F.arg=r,i.next=j,O&&(i.method="next",i.arg=n),!!O}for(var p=this.tryEntries.length-1;p>=0;--p){var g=this.tryEntries[p],F=g.completion;if(g.tryLoc==="root")return s("end");if(g.tryLoc<=this.prev){var I=d.call(g,"catchLoc"),z=d.call(g,"finallyLoc");if(I&&z){if(this.prev<g.catchLoc)return s(g.catchLoc,!0);if(this.prev<g.finallyLoc)return s(g.finallyLoc)}else if(I){if(this.prev<g.catchLoc)return s(g.catchLoc,!0)}else if(z){if(this.prev<g.finallyLoc)return s(g.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,i){for(var s=this.tryEntries.length-1;s>=0;--s){var p=this.tryEntries[s];if(p.tryLoc<=this.prev&&d.call(p,"finallyLoc")&&this.prev<p.finallyLoc){var g=p;break}}g&&(r==="break"||r==="continue")&&g.tryLoc<=i&&i<=g.finallyLoc&&(g=null);var F=g?g.completion:{};return F.type=r,F.arg=i,g?(this.method="next",this.next=g.finallyLoc,k):this.complete(F)},complete:function(r,i){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&i&&(this.next=i),k},finish:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.finallyLoc===r)return this.complete(s.completion,s.afterLoc),se(s),k}},catch:function(r){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc===r){var p=s.completion;if(p.type==="throw"){var g=p.arg;se(s)}return g}}throw new Error("illegal catch attempt")},delegateYield:function(r,i,s){return this.delegate={iterator:de(r),resultName:i,nextLoc:s},this.method==="next"&&(this.arg=n),k}},a}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(mt);var bt={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let ke=!1,Ve=()=>{};const yt=e=>{ke=e},wt=e=>{Ve=e},_t=(e,t)=>{Ve({type:e,message:t}),ke&&console.log(`[${e}] ${t}`)};var qe={logging:ke,setLogging:yt,setCustomLogger:wt,log:_t};let K=0,ve=0;const ze=e=>{const[t,a,o]=e.split(":");return parseFloat(t)*60*60+parseFloat(a)*60+parseFloat(o)};var xt=(e,t)=>{if(typeof e=="string")if(e.startsWith("  Duration")){const a=e.split(", ")[0].split(": ")[1],o=ze(a);t({duration:o,ratio:ve}),(K===0||K>o)&&(K=o)}else if(e.startsWith("frame")||e.startsWith("size")){const a=e.split("time=")[1].split(" ")[0],o=ze(a);ve=o/K,t({ratio:ve,time:o})}else e.startsWith("video:")&&(t({ratio:1}),K=0)},Ft=(e,t)=>{const a=e._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach((o,d)=>{const n=e._malloc(o.length+1);e.writeAsciiToMemory(o,n),e.setValue(a+Uint32Array.BYTES_PER_ELEMENT*d,n,"i32")}),[t.length,a]},$e={exports:{}};(function(e,t){(function(a,o){e.exports=o()})(lt,function(){function a(){var o=arguments.length;if(o===0)throw new Error("resolveUrl requires at least one argument; got none.");var d=document.createElement("base");if(d.href=arguments[0],o===1)return d.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(d,n.firstChild);for(var l=document.createElement("a"),c,u=1;u<o;u++)l.href=arguments[u],c=l.href,d.href=c;return n.removeChild(d),c}return a})})($e);const kt="@ffmpeg/ffmpeg",$t="0.10.1",Et="FFmpeg WebAssembly version",Ct="src/index.js",Lt="src/index.d.ts",St={example:"examples"},Dt={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Pt={"./src/node/index.js":"./src/browser/index.js"},Bt={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},It=["ffmpeg","WebAssembly","video"],zt="Jerome Wu <jeromewus@gmail.com>",Ot="MIT",At={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},jt={node:">=12.16.1"},Tt="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Mt={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ut={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var Ne={name:kt,version:$t,description:Et,main:Ct,types:Lt,directories:St,scripts:Dt,browser:Pt,repository:Bt,keywords:It,author:zt,license:Ot,bugs:At,engines:jt,homepage:Tt,dependencies:Mt,devDependencies:Ut};const{devDependencies:Rt}=Ne;var Gt={corePath:`https://unpkg.com/@ffmpeg/core@${Rt["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const Vt=$e.exports,{log:J}=qe,he=async(e,t)=>{J("info",`fetch ${e}`);const a=await(await fetch(e)).arrayBuffer();J("info",`${e} file size = ${a.byteLength} bytes`);const o=new Blob([a],{type:t}),d=URL.createObjectURL(o);return J("info",`${e} blob URL = ${d}`),d};var qt=async({corePath:e})=>{if(typeof e!="string")throw Error("corePath should be a string!");const t=Vt(e),a=await he(t,"application/javascript"),o=await he(t.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),d=await he(t.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(n=>{const l=document.createElement("script"),c=()=>{l.removeEventListener("load",c),J("info","ffmpeg-core.js script loaded"),n({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d})};l.src=a,l.type="text/javascript",l.addEventListener("load",c),document.getElementsByTagName("head")[0].appendChild(l)}):(J("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:a,wasmPath:o,workerPath:d}))};const Nt=$e.exports,Yt=e=>new Promise((t,a)=>{const o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:d}}})=>{a(Error(`File could not be read! Code=${d}`))},o.readAsArrayBuffer(e)});var Wt=async e=>{let t=e;return typeof e=="undefined"?new Uint8Array:(typeof e=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(a=>a.charCodeAt(0)):t=await(await fetch(Nt(e))).arrayBuffer():(e instanceof File||e instanceof Blob)&&(t=await Yt(e)),new Uint8Array(t))};const Ht=Gt,Xt=qt,Zt=Wt;var Ye={defaultOptions:Ht,getCreateFFmpegCore:Xt,fetchFile:Zt};const{defaultArgs:Kt,baseOptions:Jt}=bt,{setLogging:Oe,setCustomLogger:Ae,log:W}=qe,Qt=xt,ea=Ft,{defaultOptions:ta,getCreateFFmpegCore:aa}=Ye,{version:oa}=Ne,me=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var ia=(e={})=>{const b=H(H(H({},Jt),ta),e),{log:t,logger:a,progress:o}=b,d=Be(b,["log","logger","progress"]);let n=null,l=null,c=null,u=!1,h=o;const y=v=>{v==="FFMPEG_END"&&c!==null&&(c(),c=null,u=!1)},_=({type:v,message:$})=>{W(v,$),Qt($,h),y($)},x=async()=>{if(W("info","load ffmpeg-core"),n===null){W("info","loading ffmpeg-core");const{createFFmpegCore:v,corePath:$,workerPath:w,wasmPath:S}=await aa(d);n=await v({mainScriptUrlOrBlob:$,printErr:E=>_({type:"fferr",message:E}),print:E=>_({type:"ffout",message:E}),locateFile:(E,R)=>{if(typeof window!="undefined"){if(typeof S!="undefined"&&E.endsWith("ffmpeg-core.wasm"))return S;if(typeof w!="undefined"&&E.endsWith("ffmpeg-core.worker.js"))return w}return R+E}}),l=n.cwrap("proxy_main","number",["number","number"]),W("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},P=()=>n!==null,U=(...v)=>{if(W("info",`run ffmpeg command: ${v.join(" ")}`),n===null)throw me;if(u)throw Error("ffmpeg.wasm can only run one command at a time");return u=!0,new Promise($=>{const w=[...Kt,...v].filter(S=>S.length!==0);c=$,l(...ea(n,w))})},T=(v,...$)=>{if(W("info",`run FS.${v} ${$.map(w=>typeof w=="string"?w:`<${w.length} bytes binary file>`).join(" ")}`),n===null)throw me;{let w=null;try{w=n.FS[v](...$)}catch{throw Error(v==="readdir"?`ffmpeg.FS('readdir', '${$[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:v==="readFile"?`ffmpeg.FS('readFile', '${$[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return w}},A=()=>{if(n===null)throw me;u=!1,n.exit(1),n=null,l=null,c=null},k=v=>{h=v},m=v=>{Ae(v)};return Oe(t),Ae(a),W("info",`use ffmpeg.wasm v${oa}`),{setProgress:k,setLogger:m,setLogging:Oe,load:x,isLoaded:P,run:U,exit:A,FS:T}};const ra=ia,{fetchFile:na}=Ye;var be={createFFmpeg:ra,fetchFile:na};class sa{constructor(t){V(this,"options");this.options=t}async transforms(t){return Promise.all(t.map(async a=>await this.transform(a)))}async transform(t){const a=await this._loadImg(t.file),o=this._paintFrame({img:a,frame:t});return await this._canvasToBlob(o)}async _canvasToBlob(t){return new Promise(function(a,o){t.toBlob(function(d){d?a(d):o("\u6570\u636E\u5F02\u5E38")},"image/jpeg",1)})}_canvasToImage(t){var a=new Image;return a.src=t.toDataURL("image/png"),a}async _loadImg(t){return new Promise(function(a){const o=new Image;o.src=window.URL.createObjectURL(t),o.onload=function(){a(o)}})}_paintFrame(t){const{width:a,height:o,rule:d,background:n}=this.options,{img:l,frame:c}=t,u=document.createElement("canvas");u.width=a,u.height=o;const h=u.getContext("2d");if(!l||!h)throw new Error("\u6570\u636E\u5F02\u5E38");h.fillStyle=n,h.fillRect(0,0,u.width,u.height);const{canvasData:y,imgData:_}=function(){const{width:w,height:S}=l,{width:E,height:R}=u,G=Math.max(E/w,R/S,1),ae=[Math.floor(E/G),Math.floor(R/G)];return{imgData:[Math.floor((w-ae[0])/2),Math.floor((S-ae[1])/2),Math.floor(E/G),Math.floor(R/G)],canvasData:[0,0,E,R]}}(),[x,P,U,T]=_,[A,k,m,b]=y;h.drawImage(l,x,P,U,T,A,k,m,b);const{rotateY:v}=c;if((v==180?-1:1)==-1){const w=h.getImageData(0,0,m,b),S=h.getImageData(0,0,m,b);h.putImageData(this.canvasDataHRevert(w,S),0,0)}return u}canvasDataHRevert(t,a){for(var o=0,d=t.height;o<d;o++)for(var n=0,l=t.width;n<l;n++)a.data[o*l*4+n*4+0]=t.data[o*l*4+(l-n)*4+0],a.data[o*l*4+n*4+1]=t.data[o*l*4+(l-n)*4+1],a.data[o*l*4+n*4+2]=t.data[o*l*4+(l-n)*4+2],a.data[o*l*4+n*4+3]=t.data[o*l*4+(l-n)*4+3];return a}}class la{constructor(){V(this,"buffer");V(this,"file");V(this,"frames");V(this,"options");V(this,"music");V(this,"ffmpeg");V(this,"ratio");this.buffer={gif:null,mp4:null},this.file={gif:null,mp4:null},this.frames=[],this.options={width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5},this.music={start:0},this.ffmpeg=be.createFFmpeg({log:!1}),this.ratio=0}setOpt(t){return this.options=Object.assign(this.options,t),this}setFrame(t){return this.frames=t,this}setMusic(t){return this.music=t,this}logProgress(t,a){if(t<0)return;const o=parseFloat((((a==="gif"?1:0)+t)/2).toFixed(4));o!=this.ratio&&(this.ratio=o,console.log(`\u751F\u6210\u8FDB\u5EA6\uFF1A${this.ratio*100}%`,this.ratio))}async toPreView(){if(this.buffer={gif:null,mp4:null},this.file={gif:null,mp4:null},await this._mixinMusic(),!this.buffer.mp4||!this.buffer.gif)return{};const t=new Blob([this.buffer.mp4],{type:"video/mp4"}),a=new Blob([this.buffer.gif],{type:"image/gif"});return this.file={mp4:t,gif:a},{src:URL.createObjectURL(t),size_mp4:t.size,size_gif:a.size}}async toFile(t){const a=`${t}-${Te()}.${t}`;let o=null;switch(t){case"gif":o=this.file.gif;break;case"mp4":o=this.file.mp4;break}!o||dt.exports.saveAs(o,a)}_toTime(t){const a=t%60;return`00:${((t-a)/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}async _mixinMusic(){if(this.frames.length==0)return;this.ffmpeg.isLoaded()||await this.ffmpeg.load();const t="out.mp4",a="out.gif",o="music.mp3",{delay:d,quality:n,repeat:l}=this.options,{file:c,start:u}=this.music,h=1e3/d,y=8+Math.round((1-n)*20),_=d/1e3*this.frames.length,x=l==-1?1:0,U=await new sa(this.options).transforms(this.frames),T=[];if(U.forEach(async(m,b)=>{this.ffmpeg.FS("writeFile",`${b}.jpg`,await be.fetchFile(m)),T.push(`${b}.jpg`)}),this.ffmpeg.setProgress(({ratio:m})=>this.logProgress(m,"mp4")),c){this.ffmpeg.FS("writeFile",o,await be.fetchFile(c));const m=this._toTime(u);await this.ffmpeg.run("-r",`${h}`,"-f","image2","-i","%d.jpg","-i",o,"-ss",m,"-t",`${_}`,"-crf",`${y}`,t)}else await this.ffmpeg.run("-r",`${h}`,"-f","image2","-i","%d.jpg","-crf",`${y}`,t);const A=this.ffmpeg.FS("readFile",t).buffer;this.ffmpeg.setProgress(({ratio:m})=>this.logProgress(m,"gif")),await this.ffmpeg.run("-i",t,"-loop",`${x}`,"-vf","split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse",a);const k=this.ffmpeg.FS("readFile",a).buffer;T.forEach(m=>this.ffmpeg.FS("unlink",m)),this.buffer={gif:k,mp4:A}}}const te=e=>(Q("data-v-747a75ea"),e=e(),ee(),e),da={class:"form"},ca=te(()=>f("span",null,"\u5BBD / \u9AD8\uFF1A",-1)),ua=te(()=>f("span",null,"\u8D28\u91CF\uFF1A",-1)),fa=te(()=>f("span",{for:"background"},"\u80CC\u666F\u8272\uFF1A",-1)),ga=te(()=>f("span",{for:"delay"},"\u505C\u7559\u65F6\u95F4\uFF1A",-1)),pa=te(()=>f("span",{for:"repeat"},"\u91CD\u590D\u6B21\u6570\uFF1A",-1)),va=N({__name:"gif-canvas",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=L({width:a.value.width,height:a.value.height}),d=function(c){let u=a.value;c&&(u=Object.assign(u,c)),t("update:value",u),t("change")},n=function(c){d(c)},l=function(){d()};return(c,u)=>(D(),B("div",da,[f("div",null,[ca,C(ct,{value:o.value,onChange:n},null,8,["value"])]),f("div",null,[ua,f("div",null,[C(ut,{ref:"scaleRange",value:e.value.quality,"onUpdate:value":u[0]||(u[0]=h=>e.value.quality=h),onChange:l},null,8,["value"])])]),C(Ge),f("div",null,[fa,f("div",null,[ie(f("input",{type:"color",name:"background","onUpdate:modelValue":u[1]||(u[1]=h=>e.value.background=h),onChange:d},null,544),[[re,e.value.background]])])]),f("div",null,[ga,f("div",null,[ie(f("input",{type:"number",name:"delay",min:"0",placeholder:"\u505C\u7559\u65F6\u95F4 \u6BEB\u79D2","onUpdate:modelValue":u[2]||(u[2]=h=>e.value.delay=h),onChange:d},null,544),[[re,e.value.delay]])])]),f("div",null,[pa,f("div",null,[ie(f("input",{type:"number",name:"repeat",min:"-1",placeholder:"-1 never 0 ever or number","onUpdate:modelValue":u[3]||(u[3]=h=>e.value.repeat=h),onChange:d},null,544),[[re,e.value.repeat]])])])]))}});var ha=q(va,[["__scopeId","data-v-747a75ea"]]);const ma=e=>(Q("data-v-7d1fe6f4"),e=e(),ee(),e),ba={class:"form"},ya={class:"music-select"},wa=["onClick"],_a=ma(()=>f("span",null,"\u8D77\u59CB\u65F6\u95F4\uFF1A",-1)),xa=N({__name:"gif-music",props:{value:null},emits:["update:value","change"],setup(e,{emit:t}){const a=e,o=L([]),d=function(l){let c=a.value;l&&(c=Object.assign(c,l)),t("update:value",c),t("change")},n=function(l){l.selected||(o.value=o.value.map(c=>(c.selected=l.id==c.id,c)),d({file:l.file}))};return(l,c)=>(D(),B("div",ba,[C(ft,{value:o.value,"onUpdate:value":c[0]||(c[0]=u=>o.value=u),max_size:1024*50,file_type:["audio/mpeg"]},null,8,["value"]),f("div",ya,[f("ul",null,[(D(!0),B(xe,null,Me(o.value,u=>(D(),B("li",{class:"line",onClick:h=>n(u)},[f("span",null,Fe(u.file.name),1),f("span",null,[f("i",{class:X(["css-icon",u.selected?"select":""])},null,2)])],8,wa))),256))])]),C(Ge),f("div",null,[_a,f("div",null,[ie(f("input",{type:"number",name:"start","onUpdate:modelValue":c[1]||(c[1]=u=>e.value.start=u),onChange:d},null,544),[[re,e.value.start]])])])]))}});var Fa=q(xa,[["__scopeId","data-v-7d1fe6f4"]]);const ka={class:"list"},$a={class:"img"},Ea=["src"],Ca={class:"tools icon-group"},La=N({__name:"FrameEditor",props:{list:null},setup(e,{expose:t}){const a=e,o=L([]);Qe(a,function(){o.value=a.list.map(l=>{const c=o.value.find(u=>l.id==u.id);return c||Object.assign({rotateX:0,rotateY:0,rotateZ:0},l)})}),t({getFrames:function(){return o.value.map(l=>H({},l))}});const n=function(l){o.value[l].rotateY=o.value[l].rotateY==0?180:0};return(l,c)=>(D(),B("div",ka,[f("ul",null,[(D(!0),B(xe,null,Me(o.value,(u,h)=>(D(),B("li",{key:u.id},[f("div",$a,[f("img",{src:u.src,alt:"",style:et({transform:`rotateX(${u.rotateX}deg) rotateY(${u.rotateY}deg) rotateZ(${u.rotateZ}deg)`})},null,12,Ea),f("span",null,"\u7B2C "+Fe(h+1)+" \u5E27",1)]),f("div",Ca,[C(gt,{type:"flip-x",onClick:y=>n(h)},null,8,["onClick"])])]))),128))])]))}});var Sa=q(La,[["__scopeId","data-v-6e9ce642"]]);const Da={},Pa={class:"dialog-loading global-loading"},Ba=tt('<div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div><div class="global-loading-dot" data-v-ed30dbd0></div>',12),Ia=[Ba];function za(e,t){return D(),B("div",Pa,Ia)}var Oa=q(Da,[["render",za],["__scopeId","data-v-ed30dbd0"]]);const Aa=N({__name:"Overlay",props:{show:{type:Boolean,default:!1}},setup(e){return(t,a)=>(D(),B("div",{class:X(["overlay",e.show?"overlay-show":""])},null,2))}});var ja=q(Aa,[["__scopeId","data-v-07cab184"]]);const Ta=e=>(Q("data-v-19456f35"),e=e(),ee(),e),Ma=["id"],Ua={class:"dialog-center-box"},Ra=Ta(()=>f("span",{class:"css-icon delete bold"},null,-1)),Ga=[Ra],Va={key:1,class:"dialog-header"},qa={class:"dialog-content"},Na={key:2,class:"dialog-footer"},Ya=N({__name:"Dialog",props:{size:{type:String,default:"max-content"},needClose:{type:Boolean,default:!0},show:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["update:show","update:loading"],setup(e,{emit:t}){const a=L(Ue()),o=at(),d=function(){t("update:show",!1),t("update:loading",!1)};return(n,l)=>(D(),B("div",{id:a.value,class:X(["dialog","dialog-"+e.size,e.show?"open":""])},[C(ja,{show:e.show,onClick:d},null,8,["show"]),C(Oa,{class:X(["dialog-loading",e.loading?"show":""])},null,8,["class"]),f("div",Ua,[e.needClose?(D(),B("div",{key:0,class:"dialog-close",onClick:d},Ga)):fe("",!0),Ie(o).header?(D(),B("div",Va,[ge(n.$slots,"header",{},void 0,!0)])):fe("",!0),f("div",qa,[ge(n.$slots,"content",{},void 0,!0)]),Ie(o).footer?(D(),B("div",Na,[ge(n.$slots,"footer",{},void 0,!0)])):fe("",!0)])],10,Ma))}});var Wa=q(Ya,[["__scopeId","data-v-19456f35"]]);const Ha=["src","width"],Xa={class:"btn-group center"},Za=N({__name:"PreViewDialog",props:{ratio:{type:Number,default:1}},emits:["footer-click"],setup(e,{expose:t,emit:a}){const o=L(""),d=window.screen.height*.6,n=L(!1),l=L(!1),c=function(_=!1){n.value=!0,l.value=_};t({display:function(_){o.value=_,c()},load:function(){c(!0)},open:c});const y=function(_){a("footer-click",_)};return(_,x)=>(D(),ot(Wa,{show:n.value,"onUpdate:show":x[2]||(x[2]=P=>n.value=P),loading:l.value,"onUpdate:loading":x[3]||(x[3]=P=>l.value=P)},{content:M(()=>[f("video",{src:o.value,width:d*e.ratio,height:d,class:"preview",controls:"",autoplay:""},null,8,Ha)]),footer:M(()=>[f("div",Xa,[f("button",{class:"button large C",onClick:x[0]||(x[0]=P=>y("gif"))},"\u4E0B\u8F7DGIF"),f("button",{class:"button large C",onClick:x[1]||(x[1]=P=>y("mp4"))},"\u4E0B\u8F7DMP4")])]),_:1},8,["show","loading"]))}});var Ka=q(Za,[["__scopeId","data-v-44d1a161"]]);const We=e=>(Q("data-v-52719f86"),e=e(),ee(),e),Ja=We(()=>f("span",null,"Pic GIF",-1)),Qa=We(()=>f("button",{class:"button C"},[f("a",{href:"./collage.html"},"Pic Collage")],-1)),eo={class:"left"},to={class:"right"},ao=N({__name:"index",setup(e){const t=L([]),a=L("library"),o=L(""),d=L(),n=L(),l=L(),c=L({width:800,height:1e3,repeat:0,delay:750,background:"#FFFFFF",rule:3,quality:.5}),u=L({start:0}),h=L([]),y=new la,_=it("_message"),x=()=>{nt(()=>{o.value="",d.value.clearSelect(),_({type:"success",value:"\u6E05\u7406\u6210\u529F..."})})},P=m=>{t.value.push({value:m,timestamp:Te()})},U=async function(){var m=l.value.getFrames();if(!m||m.length==0){_({type:"warning",value:"\u8BF7\u4ECE\u56FE\u5E93\u4E2D\u9009\u62E9\u3002"});return}_({value:"\u6B63\u5728\u52A0\u8F7D\u63D2\u4EF6\uFF0C\u8BF7\u7B49\u5F85..."}),n.value.load();const b=await y.setOpt(c.value).setMusic(u.value).setFrame(m).toPreView().catch(S=>console.log(S));if(!(b!=null&&b.src))return;const{src:v,size_mp4:$,size_gif:w}=b;console.log(`
    size_mp4: ${Math.round($/1024)}KB
    size_gif: ${Math.round(w/1024)}KB
  `),n.value.display(v)},T=function(m){var b=l.value.getFrames();!b||b.length==0||y.toFile(m).catch(v=>console.log(v))},A=L([]),k=function(m){A.value=m};return(m,b)=>(D(),B(xe,null,[C(rt,{needLog:!0},{header:M(()=>[Ja]),menu:M(()=>[Qa]),main:M(()=>[f("div",eo,[C(pt,{selected:a.value,"onUpdate:selected":b[1]||(b[1]=v=>a.value=v)},{default:M(()=>[C(pe,{key:"library",title:"\u56FE\u5E93"},{default:M(()=>[C(vt,{ref_key:"galleryLoader",ref:d,value:h.value,"onUpdate:value":b[0]||(b[0]=v=>h.value=v),onLog:P,need_decision:!0,onDecision:k},null,8,["value"])]),_:1}),C(pe,{key:"music",title:"\u97F3\u4E50\u5E93"},{default:M(()=>[C(Fa,{value:u.value},null,8,["value"])]),_:1}),C(pe,{key:"setting",title:"\u8BBE\u7F6E"},{default:M(()=>[C(ha,{value:c.value},null,8,["value"])]),_:1})]),_:1},8,["selected"]),f("div",{class:"btn-group center"},[f("button",{class:"button large",onClick:U},"\u751F\u6210\u9884\u89C8")])]),f("div",to,[f("div",{class:"btn-group right"},[f("button",{class:"button A",onClick:x},"\u6E05\u7406\u5E27")]),C(Sa,{ref_key:"frameEditor",ref:l,list:A.value},null,8,["list"])])]),footer:M(()=>[C(ht,{logs:t.value},null,8,["logs"])]),_:1}),C(Ka,{ref_key:"previewDialog",ref:n,ratio:c.value.width/c.value.height,onFooterClick:T},null,8,["ratio"])],64))}});var oo=q(ao,[["__scopeId","data-v-52719f86"]]);const io=e=>(Q("data-v-0026c91e"),e=e(),ee(),e),ro=io(()=>f("i",{class:"css-icon delete"},null,-1)),no=[ro],so=N({__name:"Message",props:{type:{type:String,default:"info"},value:{type:String,default:""},timeout:{type:Number,default:3e3},remove:Function},setup(e){const t=e;let a;const o=L(!1);st(()=>{o.value=!0;const n=300;a=setTimeout(function(){o.value=!1,setTimeout(function(){typeof t.remove=="function"&&t.remove()},n)},t.timeout-n)});const d=()=>{typeof t.remove=="function"&&t.remove(),a&&clearTimeout(a)};return(n,l)=>(D(),B("div",{class:X(["global-message-box",o.value?"open":""])},[f("div",{class:X(["global-message-value",e.type])},Fe(e.value),3),f("span",{class:"global-message-btn",onClick:d},no)],2))}});var He=q(so,[["__scopeId","data-v-0026c91e"]]);let je;const ye={margin:40,zIndex:1e4};let Xe=0,Ee=ye.margin,we=[];const lo=(e,t)=>{we.push(e),e.setAttribute("no",t.toString()),e.classList.add("global_message"),e.style.position="fixed",e.style.right=`${ye.margin}px`,e.style.zIndex=ye.zIndex.toString(),e.style.top=`${Ee}px`},co=(e,t,a)=>{we.forEach((o,d)=>{d>0&&(o.style.top=`${o.offsetTop-we[d-1].offsetHeight}px`)}),Ee-=t.offsetHeight,Xe--,a&&a()},uo=(e,t)=>{const a=e.getAttribute("no");if(!a)return;const o=Re(He,Pe(H({},t),{modelValue:!0,remove(){co(parseInt(a),e,()=>{o.unmount(),document.body.removeChild(e)})}}));return o.mount(e)};function _e(e={}){e.id=`message_${Ue()}`;const t=document.createElement("div");return lo(t,Xe++),document.body.appendChild(t),je=uo(t,e),Ee+=t.offsetHeight,je}_e.install=e=>{e.component("message",He),e.provide("_message",_e)};const fo=Re(oo);fo.use(_e).mount("#app");
